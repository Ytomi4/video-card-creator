# VideoCardCreator

Figma 上で作成したマスク画像と動画を合成し、録画して書き出す Figma プラグインです。

[![How to use VideoCard Creator](https://github.com/user-attachments/assets/22c3f9fa-cf70-4cbb-bd8c-52fb3e006891)](https://youtu.be/IoeTdu-tE_8?si=QyyN8NJZzlh_EJL3)


## 概要

VideoCardCreator は、Figma で作成したフレームをマスク画像として使用し、背景動画と合成して新しい動画を作成できるプラグインです。以下の機能を提供しています：

- Figma フレームのマスク画像としての取得
- 動画ファイルのアップロードとプレビュー
- マスク画像と動画のリアルタイム合成
- 位置・スケール調整機能
- 合成結果の動画録画と WebM 形式での書き出し

## 機能

### 1. マスク画像の取得

- Figma 上で選択したフレームを PNG 形式でエクスポート
- マスク画像として上層に配置

### 2. 動画ファイルの処理

- WebM、MP4 形式の動画ファイルをアップロード
- 動画を背景層として配置

### 3. 合成とプレビュー

- マスク画像と動画を Canvas 上でリアルタイム合成
- 動画の位置調整（ドラッグ操作）
- 動画のスケール調整（スライダー操作）

### 4. 録画機能

- 60fps での高品質録画
- 音声付き動画の対応
- WebM 形式での自動書き出し

## セットアップ手順

### Figma での使用方法

1. Figma Desktop アプリケーションを開く
2. プラグインメニューから「開発」→「マニフェストからプラグインをインポート」を選択
3. `manifest.json` ファイルを選択してプラグインをロード
4. プラグインメニューから「VideoCardCreator」を実行

### 開発環境のセットアップ

開発中は以下のコマンドでファイルの変更を監視：

```bash
npm run watch
```

単発でビルドする場合：

```bash
npm run build
```

## 使用方法

### Step 1: マスク画像の準備

1. プラグインを起動
2. Figma で合成に使用したいフレームを選択
3. プラグインの UI 上で「次へ」を選択

### Step 2: 動画のアップロード

1. 「探す」ボタンで動画ファイルを選択
2. WebM または MP4 形式の動画ファイルをアップロード

### Step 3: 合成の調整

1. プレビュー画面で合成結果を確認
2. 動画をドラッグして位置を調整
3. スケールスライダーで動画サイズを調整

### Step 4: 録画と書き出し

1. 録画ボタンで録画開始
2. 動画の再生が終了すると自動的に録画停止
3. WebM 形式で動画ファイルが自動ダウンロード

## 技術仕様

- **対応動画形式**: WebM, MP4（入力）/ WebM（出力）
- **録画フレームレート**: 60fps
- **音声**: 対応（元動画の音声を保持）
- **出力解像度**: マスク画像の解像度に準拠

## ファイル構成

- `code.ts` - Figma プラグインのバックエンド（TypeScript）
- `code.js` - コンパイル済みの JavaScript
- `ui.html` - プラグインのユーザーインターフェース
- `manifest.json` - プラグインの設定ファイル
- `package.json` - NPM の設定とスクリプト

## 開発コマンド

```bash
# 開発時の自動コンパイル
npm run watch

# 単発ビルド
npm run build

# ESLintによるコードチェック
npm run lint

# ESLintの自動修正
npm run lint:fix
```
